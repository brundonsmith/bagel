
from '../../lib/wrappers/core' import { iter }

type TodoItem = {
    text: string,
    done: boolean
}

class TodoApp {
    public func memo render() =>
        <div>
            {iter<TodoItem>(this.items)
                .map<Element>(item =>
                    <div>
                        <input value={item.text} onChange={this.handleItemTextChange(item)}></input>
                        <input type={'checkbox'} checked={item.done} onChange={this.handleItemDoneChange(item)}></input>
                    </div>)
                .array()}

            <button onClick={this.addItem}>{'Add'}</button>
            <button onClick={this.clearDone}>{'Clear done'}</button>
        </div>

    items: TodoItem[] = []

    func memo handleItemTextChange(item: TodoItem) =>
        (e) {
            item.text = e.target.value;
        }

    func memo handleItemDoneChange(item: TodoItem) =>
        (e) {
            item.done = e.target.checked;
        }

    proc addItem() {
        this.items.push({ text: '', done: false });
    }

    proc clearDone() {
        this.items = iter<TodoItem>(this.items).filter(item => item.done == false).array();
    }
}

proc main() {
    let app = new TodoApp();

    autorun () {
        ___render(app.render());
    }
    forever;
}